#!/system/bin/sh

# ==========================================
# TProxyShell 核心配置文件 (settings.ini)
# 修改此文件后需要重启服务生效
# ==========================================

# --- 核心配置 ---

# 代理运行的用户和组 (格式 user:group)
CORE_USER_GROUP="root:net_admin"
# 流量标记 (Fwmark)
ROUTING_MARK="2025"
# 路由表 ID
TABLE_ID=2025

# --- 端口设置 ---

# 透明代理监听端口 (TCP/UDP)
PROXY_TCP_PORT="1536"
PROXY_UDP_PORT="1536"
# DNS 监听端口
DNS_PORT="1053"

# --- 模式选择 ---

# 代理模式 (0=自动, 1= TProxy, 2=Redirect)
PROXY_MODE=0
# DNS 劫持方式 (0=禁用, 1=TProxy, 2=Redirect)
DNS_HIJACK_ENABLE=1

# --- 网络接口定义 ---

MOBILE_INTERFACE="rmnet_data+"
WIFI_INTERFACE="wlan0"
HOTSPOT_INTERFACE="wlan2"
USB_INTERFACE="rndis+"

# --- 代理范围开关 (0=关, 1=开) ---

PROXY_MOBILE=1
PROXY_WIFI=1
PROXY_HOTSPOT=1
PROXY_USB=1
PROXY_TCP=1
PROXY_UDP=1
PROXY_IPV6=1

# --- 标记值 (通常无需修改) ---

MARK_VALUE=20
MARK_VALUE6=25

# --- 分应用代理设置 ---

# 是否启用分应用代理 (0=关, 1=开)
APP_PROXY_ENABLE=1
# 模式: "blacklist" 或 "whitelist"
APP_PROXY_MODE="whitelist"
# 代理应用列表 (白名单模式用，空格分隔包名)
PROXY_APPS_LIST="com.android.shell com.android.vending com.google.android.gms com.google.android.googlequicksearchbox com.osp.app.signin com.sec.android.app.myfiles com.ichi2.anki com.perol.pixez com.reddit.frontpage com.samsung.android.email.provider com.sec.android.app.sbrowser com.twitter.android me.weishu.kernelsu org.telegram.messenger proton.android.authenticator"
# 绕过应用列表 (黑名单模式用，空格分隔包名)
BYPASS_APPS_LIST=""

# --- 中国大陆 IP 绕过设置 ---

# 是否绕过 CN IP (0=关, 1=开)
BYPASS_CN_IP=0
# CN IP 列表文件路径
CN_IP_FILE="/data/adb/box/run/cn.zone"
CN_IPV6_FILE="/data/adb/box/run/cn_ipv6.zone"
# CN IP 下载地址
CN_IP_URL="https://raw.githubusercontent.com/Hackl0us/GeoIP2-CN/release/CN-ip-cidr.txt"
CN_IPV6_URL="https://ispip.clang.cn/all_cn_ipv6.txt"

# --- MAC 地址过滤 (仅热点模式) ---

# 是否启用 MAC 过滤 (0=关, 1=开)
MAC_FILTER_ENABLE=0
# 模式: "blacklist" 或 "whitelist"
MAC_PROXY_MODE="blacklist"
# 代理 MAC 列表 (白名单用，空格分隔)
PROXY_MACS_LIST=""
# 绕过 MAC 列表 (黑名单用，空格分隔)
BYPASS_MACS_LIST=""

# --- 调试与日志 ---

# 空运行模式 (1=仅打印命令不执行，用于调试)
DRY_RUN=0
# 日志等级 (0=Debug, 1=Info, 2=Warn, 3=Error)
LOG_LEVEL=1